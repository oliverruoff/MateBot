<!DOCTYPE HTML>
<html>
  <head>
    <title>MateBot Remote</title>
    <style>
      body {
        margin: 0px;
        padding: 0px;
        background-image: linear-gradient(rgb(0, 0, 0), rgb(61, 61, 61));
      }
    </style>
  </head>
  <body>
    <div id="imgDiv" style="width:640px;height:480px;margin:10px auto;">
      <img id="img_id" src="{{ url_for('video_feed') }}" style="position:relative;">
    </div>
    <script type="text/javascript">
        keyControl = false;
        keysPressed = [];

        function reactToKeysPressed() {
          console.log('KeysPressed: ', keysPressed)
          console.log('Length: ', keysPressed.length)
          if (keysPressed.length == 1) {
            if ((keysPressed.indexOf('KeyW') >= 0 || keysPressed.indexOf('ArrowUp') >= 0)) {
              httpGet("{{ url_for('move') }}?forward=True")
            } else if ((keysPressed.indexOf('KeyS') >= 0 || keysPressed.indexOf('ArrowDown')) >= 0) {
              httpGet("{{ url_for('move') }}?forward=False")
            } else if ((keysPressed.indexOf('KeyA') >= 0 || keysPressed.indexOf('ArrowLeft')) >= 0) {
                httpGet("{{ url_for('turn') }}?direction=left")
            } else if ((keysPressed.indexOf('KeyD') >= 0 || keysPressed.indexOf('ArrowRight')) >= 0) {
              httpGet("{{ url_for('turn') }}?direction=right")
            }
          } else if (keysPressed.length == 2) {
            if ((keysPressed.indexOf('ArrowUp') >= 0 && keysPressed.indexOf('ArrowRight') >= 0) || 
            keysPressed.indexOf('KeyW') >= 0 && keysPressed.indexOf('KeyD') >= 0) {
              httpGet("{{ url_for('joystick') }}?x=60&y=100")
            } else if ((keysPressed.indexOf('ArrowUp') >= 0 && keysPressed.indexOf('ArrowLeft') >= 0) || 
                keysPressed.indexOf('KeyW') >= 0 && keysPressed.indexOf('KeyA') >= 0) {
                  httpGet("{{ url_for('joystick') }}?x=-60&y=100")
            } else if ((keysPressed.indexOf('ArrowDown') >= 0 && keysPressed.indexOf('ArrowLeft') >= 0) || 
                keysPressed.indexOf('KeyS') >= 0 && keysPressed.indexOf('KeyA') >= 0) {
                  httpGet("{{ url_for('joystick') }}?x=-60&y=-100")
            } else if ((keysPressed.indexOf('ArrowDown') >= 0 && keysPressed.indexOf('ArrowRight') >= 0) || 
                keysPressed.indexOf('KeyS') >= 0 && keysPressed.indexOf('KeyD') >= 0) {
                  httpGet("{{ url_for('joystick') }}?x=60&y=-100")
            }
          } else if (keysPressed.length == 0) {
            httpGet("{{ url_for('stop') }}")
          } else {
            console.log('Too many buttons pressed!');
          }
        }

        document.addEventListener('keydown', function(event) {
          console.log('Key down:', event.code)
          if (keysPressed.indexOf(event.code) < 0) {
            keysPressed.push(event.code)
          }
          reactToKeysPressed();
        });

        document.addEventListener('keyup', function(event) {
          console.log('Key up:', event.code)
          indexToDelete = keysPressed.indexOf(event.code);
          if (indexToDelete >= 0) {
            keysPressed.splice(indexToDelete, 1)
          }
          reactToKeysPressed();
        });
    </script>
  </body>
</html>